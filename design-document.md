# Webアプリ仕様書

## 1. 概要
本アプリケーションは、小説などの創作活動を支援するためのWebアプリケーション「**Writer's Desk**」である。  
物語のアイデア出しから、登場人物の名前作成、文章表現の改善まで、執筆の様々な場面でAIによるサポートを提供する。

### 1.1 システムの概要説明
キーワード入力でたくさん入力したらエラーが出るようにする。
そのため、物語のプロット出力はキーワード入力を10個まで、名前生成はキーワード3つまで、類語検索はひとつだけ、描写の具体化は100文字まで、と入力制限を設ける。
 
### 1.2 システム構成図

```mermaid
graph TD
    subgraph "ユーザー環境"
        User[<img src="https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/solid/user.svg" width="30" /> ユーザー]
        Browser[<img src="https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/brands/chrome.svg" width="30" /> ブラウザ]
    end

    subgraph "Webサーバー (Flask)"
        Flask[<img src="https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/solid/server.svg" width="30" /> app.py] 
        StaticFiles[<img src="https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/solid/file-code.svg" width="30" /> 静的ファイル<br>(HTML/Vue.js)]
        HistoryFile[<img src="https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/solid/file-lines.svg" width="30" /> history.json]
    end

    subgraph "外部サービス"
        OpenRouter[<img src="https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/solid/brain.svg" width="30" /> OpenRouter API]
    end

    User --> Browser
    Browser -- "1. ページ表示リクエスト<br>(/, /plot, etc.)" --> Flask
    Flask -- "2. 静的ファイル返却" --> StaticFiles
    StaticFiles --> Browser
    Browser -- "3. APIリクエスト<br>(/api/..., Fetch API)" --> Flask
    Flask -- "4. APIリクエスト<br>(プロンプト送信)" --> OpenRouter
    OpenRouter -- "5. AIによる生成結果" --> Flask
    Flask -- "履歴の読み書き" <--> HistoryFile
    Flask -- "6. JSONレスポンス" --> Browser
```

## 2. 主な機能

### 2.1 ホーム画面 (`/`)
- アプリケーションのポータルとして機能する。
- 各機能へのナビゲーションリンクを提供する。
  - 物語のあらすじと登場人物を考える (`/plot`)
  - 文章の表現を豊かにする (`/proofread`)
  - 履歴を見る (`/history`)

### 2.2 プロット・登場人物作成画面 (`/plot`)
- **物語プロットジェネレーター機能**
  - ユーザーが入力した複数のキーワードを元に、物語のあらすじを生成する。
  - 通常のプロット生成と、コメディ風のプロット生成の2つのモードを持つ。
- **登場人物の名前作成機能**
  - ユーザーが指定した漢字（3つまで）をフルネームのどこかに含んだ、キャラクター名の候補を5つ提案する。
  - 「日本人名（漢字）」と「外国人名（カタカナ）」の生成モードを切り替えられる。外国人名モードでは、響きやイメージのキーワードから名前を生成する。
  - 各候補には、名前が持つ雰囲気や由来に関する簡単な説明が付与される。

### 2.3 文章表現支援画面 (`/proofread`)
- **類語・言い換え検索機能**
  - ユーザーが入力した単語の類語を3つ提案し、それぞれのニュアンスの違いや使用例を解説する。
- **描写の具体化機能**
  - ユーザーが入力した短い文章を、五感や感情の表現を加えて、情景が目に浮かぶような豊かな描写に書き換える。

### 2.4 生成履歴画面 (`/history`)
- すべてのAI生成機能の利用履歴（ユーザー入力とAIの応答）を時系列で一覧表示する。
- 履歴はサーバー上のファイル(`history.json`)に永続的に保存される。
- 各履歴をお気に入りに登録する機能を持つ。
- 「お気に入りのみ表示」で履歴を絞り込むことができる。
- 全ての履歴を一括で削除する機能を持つ。

### 2.5 バックエンドAPI
- 各機能に対応するAPIエンドポイントを提供する。
  - `/send_api`: プロット生成
  - `/api/generate_name`: 名前生成
  - `/api/proofread`: 描写の具体化
  - `/api/thesaurus`: 類語検索
  - `/api/history`: 履歴データの提供
  - `/api/history/toggle_favorite/<item_id>`: 履歴のお気に入り状態を切り替え
  - `/api/history/clear`: 全履歴を削除
- ユーザー入力と各機能専用のシステムプロンプトを合成し、OpenRouter APIへリクエストを送信する。
- 応答をJSON形式でフロントエンドに返す。

## 3. 使用技術

| 分類 | 技術・ライブラリ |
|--------------|------------------|
| フロントエンド | HTML5, CSS3, Vue.js (CDN), Bootstrap |
| バックエンド | Python, Flask |
| 通信方式     | Fetch API / JSON |
| AIバックエンド | OpenRouter API |
| Pythonライブラリ | Flask, python-dotenv, openai |

## 4. 入出力例

### 4.1 プロット生成
- **ユーザー入力**: `春、川辺、幸せ`
- **付与コンテキスト**: `あなたはプロの小説家です。与えられたキーワードを元に、読者が続きを読みたくなるような、魅力的で簡潔な物語のあらすじを300字以内で作成してください。`
- **出力例**: `春の訪れを告げる桜の花びらが舞い落ちる川辺で、幼なじみの紬と遥は久しぶりに再会する。子どもの頃に交わした「大人になったらまたここで会おう」という約束を思い出しながら、二人はそれぞれの“幸せ”を川のせせらぎとともに分かち合う。`

### 4.2 名前生成
- **ユーザー入力 (日本人名モード)**: `月、桜`
- **付与コンテキスト**: `あなたはプロの作家です。指定された漢字「月、桜」をフルネームのどこかに含んだ、日本のキャラクター名を5つ提案してください...`
- **出力例**:
  - `- 月島 桜（つきしま さくら） - 明るく活発、春のような笑顔が魅力的な現代少女。`
  - `- 桜月 凛（さくらずき りん） - 静かで美しい、月明かりに照らされた桜を連想させる。`

### 4.3 描写の具体化
- **ユーザー入力**: `男が部屋に入ってきた`
- **付与コンテキスト**: `あなたはプロの小説家です。以下のユーザーが入力した短い文章を、情景が目に浮かぶような、豊かで具体的な小説の描写に書き換えてください...`
- **出力例**: `軋むような音を立てて重い木製のドアが開き、一人の男が影を引きずりながら部屋に足を踏み入れた。部屋に満ちていた古書の黴臭い匂いに、湿った土の匂いが混じる。`

### 4.4 類語検索
- **ユーザー入力**: `美しい`
- **付与コンテキスト**: `あなたは語彙の専門家です。ユーザーから提供されたキーワード「美しい」について、類語や言い換え表現を3つ提案し、それぞれの違いが明確にわかるように解説してください...`
- **出力例**:
  - `**麗しい（うるわしい）**`
  - `ニュアンス:  「美しい」よりもさらに洗練され、上品で、心惹かれるような美しさを指します。主に容姿や風景など、視覚的な美に対して用いられ、感情的な感動を伴うことが多いです。`
  - `使用例: 麗しい花嫁`

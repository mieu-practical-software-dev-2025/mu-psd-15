# テスト仕様書: 創作支援AI - Writer's Desk

## 1. テスト対象
- `app.py`（Flaskサーバー/APIバックエンド）
- `static/` 以下のHTML/Vue.jsファイル（フロントエンドUI）
  - `home.html`
  - `index.html` (物語の創造)
  - `proofread.html` (文章の洗練)
  - `history.html` (生成履歴)

## 2. テスト環境
- Windows 10/11
- Python 3.8以降
- Flask, openai, python-dotenv
- OpenRouter APIキー設定済み
- ブラウザ: Edge

## 3. テスト項目

### 3.1. バックエンド (app.py) テスト

#### 3.1.1. サーバー起動・ページ配信
| No | テスト内容 | 手順 | 実行結果 |
|----|------------|------|----------|
| 1-1  | サーバー起動 | `python app.py`で起動 | エラーなく起動し、`http://localhost:5000`でアクセス可能。 |
| 1-2  | ホーム画面表示 | ブラウザで`/`にアクセス | `home.html`が正常に表示される。 |
| 1-3  | 物語の創造画面表示 | ブラウザで`/plot`にアクセス | `index.html`が正常に表示される。 |
| 1-4  | 文章の洗練画面表示 | ブラウザで`/proofread`にアクセス | `proofread.html`が正常に表示される。 |
| 1-5  | 生成履歴画面表示 | ブラウザで`/history`にアクセス | `history.html`が正常に表示される。 |

#### 3.1.2. APIエンドポイント 正常系
| No | APIエンドポイント | テスト内容 | 手順 | 実行結果 |
|----|-----------------|------------|------|----------|
| 2-1  | `/send_api` | プロット生成 | `text`と`context`を含むJSONをPOST | AIによる生成テキストとメッセージを含むJSONが返る。`history.json`に記録が追加される。 |
| 2-2  | `/api/generate_name` | 日本人名生成 | `text`と`mode: "japanese"`を含むJSONをPOST | AIによる生成テキストとメッセージを含むJSONが返る。`history.json`に記録が追加される。 |
| 2-3  | `/api/generate_name` | 外国人名生成 | `text`と`mode: "foreign"`を含むJSONをPOST | AIによる生成テキストとメッセージを含むJSONが返る。`history.json`に記録が追加される。 |
| 2-4  | `/api/proofread` | 描写の具体化 | `text`を含むJSONをPOST | AIによる生成テキストとメッセージを含むJSONが返る。`history.json`に記録が追加される。 |
| 2-5  | `/api/thesaurus` | 類語検索 | `text`を含むJSONをPOST | AIによる生成テキストとメッセージを含むJSONが返る。`history.json`に記録が追加される。 |
| 2-6  | `/api/history` | 履歴取得 | GETリクエストを送信 | `history.json`の内容がJSON配列として返る。 |
| 2-7  | `/api/history/toggle_favorite/:id` | お気に入り切替 | 存在する`id`を指定してPOST | `history.json`の該当項目の`favorite`がトグルされる。 |
| 2-8  | `/api/history/clear` | 全履歴削除 | POSTリクエストを送信 | `history.json`が空の配列になる。 |

#### 3.1.3. APIエンドポイント 異常系
| No | APIエンドポイント | テスト内容 | 手順 | 実行結果 |
|----|-----------------|------------|------|----------|
| 3-1  | 全API共通 | APIキー未設定 | `.env`の`OPENROUTER_API_KEY`を空にしてAPIを叩く | 500エラーと`{"error": "OpenRouter API key is not configured on the server."}`が返る。 |
| 3-2  | 全API共通 | `text`フィールドなし | `text`を含まないJSONをPOST | `{"error": "キーワード..."}`が返る。 |
| 3-3  | 全API共通 | `text`が空文字 | `{"text": " "}`をPOST | `{"error": "キーワード..."}`が返る。 |
| 3-4  | `/send_api` | キーワード数超過 | 11個のキーワードをPOST | 400エラーと`{"error": "キーワード..."}`が返る。 |
| 3-5  | `/api/generate_name` | キーワード数超過 | 4つのキーワードをPOST | 400エラーと`{"error": "漢字..."}`または`{"error": "キーワード..."}`が返る。 |
| 3-6  | `/api/proofread` | 文字数超過 | 101文字以上の文章をPOST | 400エラーと`{"error": "入力できる文字数は100文字までです。"}`が返る。 |
| 3-7  | `/api/thesaurus` | キーワード数超過 | 2つのキーワードをPOST | 400エラーと`{"error": "キーワードを一つだけ入力してください。"}`が返る。 |
| 3-8  | `/api/history/toggle_favorite/:id` | 存在しないID | 存在しない`id`を指定してPOST | 404エラーと`{"error": "Item not found."}`が返る。 |

### 3.2. フロントエンド (UI) テスト

#### 3.2.1. 全ページ共通
| No | テスト内容 | 手順 | 実行結果 |
|----|------------|------|----------|
| 4-1  | ナビゲーションバー | 各ページのナビゲーションバーのリンクをクリック | 対応するページ (`/`, `/plot`, `/proofread`, `/history`) に正しく遷移する。 |
| 4-2  | アクティブリンク | 各ページを表示 | 現在表示しているページのナビゲーションリンクがアクティブ状態 (`active`クラス) になっている。 |

#### 3.2.2. 物語の創造 (`index.html`)
| No | テスト内容 | 手順 | 実行結果 |
|----|------------|------|----------|
| 5-1  | プロット生成（正常） | キーワードを入力し「プロットを生成」をクリック | ローディングスピナーが表示され、ボタンが無効化される。成功後、結果が緑のアラートで表示される。 |
| 5-2  | プロット生成（コメディ） | キーワードを入力し「コメディ風で生成」をクリック | ローディングスピナーが表示され、ボタンが無効化される。成功後、結果が緑のアラートで表示される。 |
| 5-3  | プロット生成（入力なし） | キーワードを空のままボタンをクリック | 「キーワードを入力してください。」というエラーメッセージが表示される。 |
| 5-4  | 名前生成（日本人名） | 「日本人名」を選択し、キーワードを入力して「名前を生成」をクリック | ローディングスピナーが表示され、ボタンが無効化される。成功後、結果が薄いグレーのアラートで表示される。 |
| 5-5  | 名前生成（外国人名） | 「外国人名」を選択し、キーワードを入力して「名前を生成」をクリック | ローディングスピナーが表示され、ボタンが無効化される。成功後、結果が薄いグレーのアラートで表示される。 |
| 5-6  | 名前生成（入力なし） | キーワードを空のままボタンをクリック | 「キーワードを入力してください。」というエラーメッセージが表示される。 |
| 5-7  | 名前生成モード切替 | ラジオボタンを切り替える | プレースホルダーのテキストが「名前に含めたい漢字...」と「名前の響きやイメージ...」で切り替わる。 |

#### 3.2.3. 文章の洗練 (`proofread.html`)
| No | テスト内容 | 手順 | 実行結果 |
|----|------------|------|----------|
| 6-1  | 類語検索（正常） | 単語を入力し「類語を探す」をクリック | ローディングスピナーが表示され、ボタンが無効化される。成功後、結果が薄いグレーのアラートで表示される。 |
| 6-2  | 類語検索（入力なし） | 単語を空のままボタンをクリック | 「キーワードを入力してください。」というエラーメッセージが表示される。 |
| 6-3  | 描写生成（正常） | 文章を入力し「描写を生成」をクリック | ローディングスピナーが表示され、ボタンが無効化される。成功後、結果が緑のアラートで表示される。 |
| 6-4  | 描写生成（入力なし） | 文章を空のままボタンをクリック | 「変換したい文章を入力してください。」というエラーメッセージが表示される。 |
| 6-5  | コピー機能 | 描写生成後、結果の右上にあるコピーボタンをクリック | ボタンのアイコンとテキストが「コピー完了!」に変わり、2秒後に元に戻る。クリップボードに結果がコピーされている。 |

#### 3.2.4. 生成履歴 (`history.html`)
| No | テスト内容 | 手順 | 実行結果 |
|----|------------|------|----------|
| 7-1  | 履歴表示 | ページを開く | ローディングスピナーが表示された後、履歴が新しいものから順にカード形式で表示される。 |
| 7-2  | 履歴なし表示 | `history.json`を空にしてページを開く | 「履歴はまだありません。」というメッセージが表示される。 |
| 7-3  | お気に入り切替 | 星アイコンをクリック | 星アイコンの色と形が即座に切り替わる。ページをリロードしても状態が保持されている。 |
| 7-4  | お気に入りフィルタ | 「お気に入りのみ表示」スイッチをオンにする | お気に入りに登録された履歴のみが表示される。スイッチをオフにすると全履歴が表示される。 |
| 7-5  | 全履歴削除 | 「全履歴を削除」ボタンをクリックし、確認ダイアログで「OK」を選択 | 履歴が全て削除され、「履歴はまだありません。」と表示される。ページをリロードしても履歴は空のまま。 |
| 7-6  | 全履歴削除（キャンセル） | 「全履歴を削除」ボタンをクリックし、確認ダイアログで「キャンセル」を選択 | 履歴は削除されず、表示は変わらない。 |


## 4. その他
| No | テスト内容 | 手順 | 実行結果 |
|----|------------|------|----------|
| 8-1  | レスポンス速度の計測 | ユーザーが入力してからAIが出力を返すまでの時間をは測る。 | プロット出力は約13~14秒程度。 名前生成は約8秒程度。類語検索は約8~15秒程度。描写の具体化は8秒程度。|
